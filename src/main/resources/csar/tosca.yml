tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: org.alien4cloud.security-groups
  template_version: 2.0.0-SNAPSHOT
  template_author: alien4cloud

description: TOSCA components to represent Security Group.

imports:
  - tosca-normative-types:1.0.0-ALIEN14

data_types:

  org.alien4cloud.datatypes.SecurityGroupRule:
    derived_from: tosca.datatypes.Root
    description: Describe a security group rule
    properties:
      name:
        type: string
        description: The name of the security group rule
        required: false
      protocol:
        type: string
        constraints:
          - valid_values: [ 'UDP', 'TCP', 'ICMP']
          # - in_range: [ 0, 255 ]
          # c.f.  https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_IpPermission.html
          #       https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml
        default: TCP
      direction:
        type: string
        constraints:
          - valid_values: [ 'inbound', 'outbound']
        default: inbound
      port:
        type: integer
        constraints:
          - in_range : [ 0, 65535 ]
      target:
        type: string
        description: CIDR or a security group name
        constraints:
          - pattern: '([1-9][0-9]{0,2}\.[0-9]{0,3}\.[0-9]{0,3}\.[0-9]{0,3}(/[0-9]{1,2})?)|[a-zA-Z-0-9]*' # 10.0.10.2, 10.0.10.0/24 or sg-17281a2

node_types:

  org.alien4cloud.nodes.SecurityGroup:
    abstract: true
    derived_from: tosca.nodes.Root
    description: Represent a security groups
    requirements:
      secure_endpoint:
        capability: tosca.capabilities.Endpoint
        relationship: org.alien4cloud.relationships.aws.SecurityGroup
        occurrences: [0, unbounded]
    properties:
      name:
        type: string
        description: The name of the security group
        required: true
      rules:
        type: list
        entry_schema:
          type: org.alien4cloud.datatypes.SecurityGroupRule

  org.alien4cloud.nodes.aws.SecurityGroup:
    derived_from: org.alien4cloud.nodes.SecurityGroup
    description: Implementation of a security group in AWS


relationship_types:

  org.alien4cloud.relationships.aws.SecurityGroup:
    derived_from: tosca.relationships.DependsOn
    valid_target_types: [ tosca.capabilities.Endpoint ]